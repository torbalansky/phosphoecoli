{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="search-list">
    <form class="form-inline" method="get" action="{% url 'protein_list' %}">
        <div class="input-group mb-2">
            <label for="search_category" class="visually-hidden">Search Category:</label>
            <select class="custom-select-list" id="search_category" name="search_category">
                <option value="uniprot">UniProt ID</option>
                <option value="gene">Gene Name</option>
                <option value="protein">Protein Name</option>
            </select>
            <input class="form-control form-control-list border-0" type="search" placeholder="Search" aria-label="Search" name="q" id="q">
        </div>
        <div class="input-group mb-2">
            <label for="modification_type" class="visually-hidden">Modification Type:</label>
            <select class="custom-select-list" id="modification_type" name="modification_type">
                <option value="">Amino acid</option>
                <option value="Y">Y</option>
                <option value="H">H</option>
                <option value="S">S</option>
                <option value="T">T</option>
            </select>
            <button class="btn btn-primary list" type="submit">Search</button>
        </div>
        <div class="button-clear">
            <button type="button" id="clearButton" class="btn btn-danger list">Clear</button>
        </div>
    </form>
</div>
    <div class="row protein-list-container">
        <div class="col">
            <table class="table table-striped res">
                <thead>
                    <tr>
                        <th>UniProt</th>
                        <th>Gene</th>
                        <th class="hide-on-sm">Protein</th>
                        <th>pSite</th>
                        <th>Details</th>
                    </tr>
                </thead>
                <tbody>
                    {% for protein in proteins %}
                        <tr class="{% cycle 'odd' 'even' %}">
                            <td class="uniprot_link">
                                {% if protein.uniprot_url %}
                                    <a href="{{ protein.uniprot_url }}" target="_blank">{{ protein.uniprot_code }}</a>
                                {% else %}
                                    {{ protein.uniprot_code }}
                                {% endif %}
                            </td>
                            <td>{{ protein.gene_name }}</td>
                            <td class="hide-on-sm">{{ protein.protein_name }}</td>
                            <td>
                                {% if protein.position %}
                                {{ protein.modification_type }}{{ protein.position }}
                                {% else %}
                                    No phosphosite found
                                {% endif %}
                            </td>                                                
                            <td><a href="{% url 'protein_details' pk=protein.pk %}" class="btn btn-light">View</a></td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="5" class="text-center">No proteins found.</td>
                        </tr>
                    {% endfor %}
                </tbody>                
            </table>
        </div>
    </div>

    {% if is_paginated %}
    <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page=1">&laquo; first</a>
                <a href="?page={{ page_obj.previous_page_number }}"><i class="fas fa-angle-left"></i> previous</a>
            {% endif %}

            <span class="current">
                Page {{ page_obj.number }} of {{ paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">next <i class="fas fa-angle-right"></i></a>
                <a href="?page={{ paginator.num_pages }}">last <i class="fas fa-angle-double-right"></i></a>
            {% endif %}
        </span>
    </div>
{% endif %}

<script>
    const searchCategoryDropdown = document.getElementById('search_category');
    const searchQueryInput = document.querySelector('.form-control-list');
      
    function setPlaceholder() {
    const selectedOption = searchCategoryDropdown.value;
        
        switch (selectedOption) {
            case 'uniprot':
                searchQueryInput.placeholder = 'Enter UniProt code, e.g. P08200';
                break;
            case 'gene':
                searchQueryInput.placeholder = 'Enter Gene Name, e.g. icd';
                break;
            case 'protein':
                searchQueryInput.placeholder = 'Enter protein Name, e.g. Isocitrate dehydrogenase';
                break;
            default:
                searchQueryInput.placeholder = 'P08200';
        }
    }
      
    window.addEventListener('load', setPlaceholder);
    searchCategoryDropdown.addEventListener('change', setPlaceholder);
    document.addEventListener('DOMContentLoaded', function() {
    const clearButton = document.getElementById('clearButton');
        clearButton.addEventListener('click', function() {
            searchCategoryDropdown.value = 'uniprot';
            searchQueryInput.value = '';
            const form = clearButton.closest('form');
            form.submit();
        });
    });
</script>
{% endblock %}
